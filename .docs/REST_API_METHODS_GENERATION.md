The following references several files and line numbers within the 'cosmos/cosmos-sdk' repo. For each section where these are cited, consider it essential/mandatory reading, as it adds crucial context.



## Cosmos SDK REST API Generation and Swagger Documentation Flow
Traces the complete flow from protobuf service definitions to REST API generation and Swagger documentation creation, covering the grpc-gateway translation process and API server route registration. Key locations include proto service definitions [1e], code generation scripts [2c], gateway registration [3d], and Swagger combination [4b].
### 1. Proto Service Definition with HTTP Annotations
Defines the foundation where REST endpoints are specified in protobuf services using Google API annotations
### 1a. Service Definition (`query.proto:16`)
Start of gRPC service that will generate REST endpoints
```text
service Query {
```
### 1b. RPC Method Definition (`query.proto:18`)
Defines the gRPC method that will have REST mapping
```text
rpc Balance(QueryBalanceRequest) returns (QueryBalanceResponse) {
```
### 1c. HTTP Route Annotation (`query.proto:20`)
Maps gRPC method to REST GET endpoint with path parameters
```text
option (google.api.http).get = "/cosmos/bank/v1beta1/balances/{address}/by_denom";
```
### 1d. HTTP Annotations Import (`query.proto:6`)
Import that enables REST route mapping in protobuf
```text
import "google/api/annotations.proto";
```
### 1e. Go Package Specification (`query.proto:13`)
Specifies where generated Go code will be placed
```text
option go_package = "github.com/cosmos/cosmos-sdk/x/bank/types";
```
### 2. Code Generation Process
Executes protobuf compilation to generate gRPC gateway code and Swagger documentation
### 2a. Swagger Generation Target (`Makefile:416`)
Makefile target that triggers Swagger documentation generation
```text
proto-swagger-gen:
```
### 2b. Script Execution (`Makefile:418`)
Runs the Swagger generation script in Docker container
```text
@$(protoImage) sh ./scripts/protoc-swagger-gen.sh
```
### 2c. Buf Swagger Generation (`protoc-swagger-gen.sh:12`)
Uses buf tool with swagger template to generate individual Swagger files
```text
buf generate --template buf.gen.swagger.yaml $query_file
```
### 2d. gRPC Gateway Generation (`protocgen.sh:21`)
Generates gRPC gateway code using gogo protobuf template
```text
buf generate --template buf.gen.gogo.yaml $file
```
### 2e. Swagger Combination (`protoc-swagger-gen.sh:20`)
Combines individual Swagger files into unified API documentation
```text
swagger-combine ./client/docs/config.json -o ./client/docs/swagger-ui/swagger.yaml
```
### 3. API Server Route Registration
Registers generated gRPC gateway routes with the HTTP server during application startup
### 3a. API Route Registration (`start.go:529`)
Application registers all API routes with the server
```text
app.RegisterAPIRoutes(apiSrv, svrCfg.API)
```
### 3b. Route Registration Implementation (`app.go:195`)
Runtime app implementation of API route registration
```text
func (a *App) RegisterAPIRoutes(apiSvr *api.Server, _ config.APIConfig) {
```
### 3c. Transaction Routes (`app.go:198`)
Registers transaction-related gRPC gateway routes
```text
authtx.RegisterGRPCGatewayRoutes(clientCtx, apiSvr.GRPCGatewayRouter)
```
### 3d. Module Routes Registration (`app.go:207`)
Registers all module gRPC gateway routes through the basic manager
```text
a.basicManager.RegisterGRPCGatewayRoutes(clientCtx, apiSvr.GRPCGatewayRouter)
```
### 3e. Module Route Implementation (`module.go:81`)
Individual module implementation of gRPC gateway route registration
```text
func (AppModuleBasic) RegisterGRPCGatewayRoutes(clientCtx client.Context, mux *gwruntime.ServeMux) {
```
### 4. Generated Gateway Code Structure
Examines the auto-generated gRPC gateway code that translates REST to gRPC calls
### 4a. Generated Code Header (`query.pb.gw.go:1`)
Auto-generated file that translates REST to gRPC
```text
// Code generated by protoc-gen-grpc-gateway. DO NOT EDIT.
```
### 4b. Reverse Proxy Purpose (`query.pb.gw.go:5`)
Documentation explaining the gateway's role as REST-to-gRPC translator
```text
Package types is a reverse proxy.
```
### 4c. Handler Registration (`module.go:82`)
Registers the generated query handler with the gRPC gateway mux
```text
if err := types.RegisterQueryHandlerClient(context.Background(), mux, types.NewQueryClient(clientCtx)); err != nil {
```
### 4d. Request Handler Function (`query.pb.gw.go:40`)
Generated function that handles REST request translation
```text
func request_Query_Balance_0(ctx context.Context, marshaler runtime.Marshaler, client QueryClient, req *http.Request, pathParams map[string]string) (proto.Message, runtime.ServerMetadata, error) {
```
### 5. Swagger Documentation Generation
Creates and serves the combined Swagger API documentation
### 5a. Swagger Plugin Configuration (`buf.gen.swagger.yaml:1`)
Buf configuration for generating Swagger documentation
```text
version: v1
plugins:
  - name: swagger
    out: ../tmp-swagger-gen
```
### 5b. Individual Swagger Files (`config.json:18`)
Configuration references individual generated Swagger files for combination
```text
"url": "./tmp-swagger-gen/cosmos/bank/v1beta1/query.swagger.json",
```
### 5c. Swagger UI Embedding (`embed.go:5`)
Embeds Swagger UI files into the binary for serving
```text
//go:embed swagger-ui
var SwaggerUI embed.FS
```
### 5d. Swagger Route Registration (`swagger.go:14`)
Registers Swagger UI routes with the HTTP server
```text
func RegisterSwaggerAPI(_ client.Context, rtr *mux.Router, swaggerEnabled bool) error {
```
### 5e. Swagger Route Handler (`swagger.go:25`)
Sets up the static file server for Swagger UI at /swagger/ endpoint
```text
rtr.PathPrefix("/swagger/").Handler(http.StripPrefix("/swagger/", staticServer))
```
### 6. HTTP Server Integration
Integrates the gRPC gateway with the HTTP server to serve REST endpoints
### 6a. Gateway Router Field (`server.go:34`)
Server struct field holding the gRPC gateway router
```text
GRPCGatewayRouter *runtime.ServeMux
```
### 6b. gRPC Server Assignment (`server.go:92`)
Assigns the gRPC server to the API server during construction
```text
GRPCSrv: grpcSrv,
```
### 6c. Gateway Router Registration (`server.go:154`)
Registers the gRPC gateway router to handle all HTTP requests
```text
s.Router.PathPrefix("/").Handler(s.GRPCGatewayRouter)
```
### 6d. Gateway Request Handling (`server.go:149`)
Delegates HTTP requests to the gRPC gateway router for processing
```text
s.GRPCGatewayRouter.ServeHTTP(w, req)
```
